<UserControl x:Class="Mentor.Uno.Views.StreamingFeedbackView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:Mentor.Uno"
             xmlns:viewModels="using:Mentor.Uno.ViewModels">
  <UserControl.Resources>
    <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
  </UserControl.Resources>

  <Grid Padding="20" Visibility="{x:Bind ViewModel, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
    <ScrollViewer>
      <StackPanel Spacing="20">
        <!-- Header -->
        <StackPanel Spacing="8">
          <TextBlock Text="LLM Analysis in Progress"
                     Style="{StaticResource TitleTextBlockStyle}"/>
          <TextBlock Text="{x:Bind ViewModel.CurrentStatus, Mode=OneWay}"
                     Style="{StaticResource BodyTextBlockStyle}"
                     Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Content Grid: Events Log and Accumulated Text -->
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>

          <!-- Events Log (Left Side) -->
          <StackPanel Grid.Column="0" Spacing="8">
            <TextBlock Text="Activity Log"
                       Style="{StaticResource SubtitleTextBlockStyle}"/>
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    CornerRadius="4"
                    Padding="12"
                    MinHeight="400"
                    MaxHeight="600">
              <ScrollViewer x:Name="EventsScrollViewer"
                            VerticalScrollBarVisibility="Auto">
                <ItemsRepeater ItemsSource="{x:Bind ViewModel.Events, Mode=OneWay}">
                  <ItemsRepeater.ItemTemplate>
                    <DataTemplate x:DataType="viewModels:StreamingEvent">
                      <StackPanel Spacing="4" Margin="0,0,0,12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                          <TextBlock Text="{x:Bind Icon}"
                                     FontSize="14"
                                     VerticalAlignment="Center"/>
                          <TextBlock Text="{x:Bind ToolName}"
                                     FontWeight="SemiBold"
                                     VerticalAlignment="Center"/>
                          <TextBlock Text="{x:Bind FormattedTime}"
                                     FontSize="11"
                                     Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                     VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{x:Bind Details}"
                                   FontSize="12"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   TextWrapping="Wrap"
                                   Margin="22,0,0,0"/>
                      </StackPanel>
                    </DataTemplate>
                  </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
              </ScrollViewer>
            </Border>
          </StackPanel>

          <!-- Accumulated Text (Right Side) -->
          <StackPanel Grid.Column="2" Spacing="8">
            <TextBlock Text="Response Stream"
                       Style="{StaticResource SubtitleTextBlockStyle}"/>
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderThickness="1"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    CornerRadius="4"
                    Padding="12"
                    MinHeight="400"
                    MaxHeight="600">
              <ScrollViewer x:Name="ResponseScrollViewer"
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Disabled">
                <TextBlock Text="{x:Bind ViewModel.AccumulatedText, Mode=OneWay}"
                           TextWrapping="Wrap"
                           IsTextSelectionEnabled="True"
                           FontFamily="Consolas"
                           FontSize="12"/>
              </ScrollViewer>
            </Border>
          </StackPanel>
        </Grid>

      </StackPanel>
    </ScrollViewer>
  </Grid>
</UserControl>

